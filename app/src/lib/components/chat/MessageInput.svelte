<script lang="ts">
	import Icon from '$lib/components/ui/Icon.svelte';
	import { createEventDispatcher } from 'svelte';
	import { onMount } from 'svelte';
	import { slide, fade, fly } from 'svelte/transition';

	// import {
	// 	isTextareaFocused,
	// 	handleTextareaFocus,
	// 	handleTextareaBlur,
	// 	adjustFontSize
	// } from '$lib/stores/textareaFocusStore';
	import { showThreadList, threadsStore } from '$lib/stores/threadsStore';
	import { uiStore, expandedSections } from '$lib/stores/uiStore';
	import { currentUser } from '$lib/pocketbase';
	import { t } from '$lib/stores/translationStore';
	import ThreadCollaborators from '$lib/features/threads/components/ThreadCollaborators.svelte';
	import SysPromptSelector from '$lib/features/ai/components/prompts/SysPromptSelector.svelte';
	import PromptCatalog from '$lib/features/ai/components/prompts/PromptInput.svelte';
	import ModelSelector from '$lib/features/ai/components/models/ModelSelector.svelte';
	import MsgBookmarks from '$lib/features/ai/components/chat/MsgBookmarks.svelte';
	import { availablePrompts } from '$lib/features/ai/utils/prompts';
	import type { AIModel, ExpandedSections } from '$lib/types/types';
	import { getIcon, type IconName } from '$lib/utils/lucideIcons';
	import { derived } from 'svelte/store';

	// Props
	export let userInput = '';
	export let isLoading = false;
	export let isAiActive = true;
	export let currentThreadId: string | null = null;
	export let aiModel: AIModel;
	export let selectedModelLabel = '';
	export let selectedPromptLabel = '';
	// export let selectedIcon: IconName | null = null;
	// export let currentPlaceholder = '';
	export let placeholderText = '';
	export let showTextModal = false;
	export let createHovered = false;
	export let isPlaceholder = false;
	export let currentManualPlaceholder = $t('chat.manualPlaceholder');

	// Constants
	const MAX_VISIBLE_CHARS = 200;

	// DOM references
	let textareaElement: HTMLTextAreaElement | null = null;
	// let localIsFocused = false;
	let isButtonAreaHovered = false;
	let blurTimeout: number | undefined;
	let isTextareaFocused = false;

	// Event dispatcher
	const dispatch = createEventDispatcher();

	// Event handlers

	let clickOutsideTimeout: number | undefined;

	function handleClickOutside(event: MouseEvent) {
		if (clickOutsideTimeout) clearTimeout(clickOutsideTimeout);

		clickOutsideTimeout = setTimeout(() => {
			const target = event.target as Node;
			const inputContainer = textareaElement?.closest('.input-container');

			if (inputContainer && !inputContainer.contains(target)) {
				uiStore.closeAllSections();
			}
		}, 10) as unknown as number;
	}
	let isFocused = false;

	let focusDebounceTimer: number | undefined;
	let isProcessingFocus = false;

	function onTextareaFocus(event: FocusEvent) {
		if (isProcessingFocus) return; // Prevent multiple rapid focus events

		isProcessingFocus = true;

		if (focusDebounceTimer) clearTimeout(focusDebounceTimer);
		if (blurTimeout) clearTimeout(blurTimeout);

		focusDebounceTimer = setTimeout(() => {
			isFocused = true;
			dispatch('textareaFocus');

			setTimeout(() => {
				isProcessingFocus = false;
			}, 100);
		}, 50) as unknown as number;
	}

	function onTextareaBlur(event: FocusEvent) {
		if (isProcessingFocus) return;

		if (blurTimeout) clearTimeout(blurTimeout);

		blurTimeout = setTimeout(() => {
			if (!isButtonAreaHovered) {
				isFocused = false;
				dispatch('textareaBlur');
			}
		}, 150) as unknown as number; // Increased delay
	}

	let inputTimeout: number | undefined;
	let resizeTimeout: number | undefined;
	const DEBOUNCE_DELAY = 300;

	function handleInput(event: Event) {
		const target = event.currentTarget as HTMLTextAreaElement;
		userInput = target.value;
	}
	function handleKeydown(event: KeyboardEvent) {
		if (event.key === 'Enter' && !event.shiftKey) {
			event.preventDefault();
			if (!isLoading) {
				handleSendMessage();
			}
		}
	}

	function handleSendMessage() {
		console.log('Sending message:', userInput);
		dispatch('sendMessage', { message: userInput });
	}

	function toggleSection(section: string) {
		console.log('🔧 Parent toggleSection called with:', section);
		console.log('🔧 Current expandedSections before:', $expandedSections);

		uiStore.toggleSection(section as keyof ExpandedSections);

		// Check after a short delay to see if it worked
		setTimeout(() => {
			console.log('🔧 expandedSections after toggle:', $expandedSections);
		}, 10);
	}

	function toggleAiActive() {
		isAiActive = !isAiActive;
		console.log('Toggling AI active:', isAiActive);
		dispatch('toggleAiActive');
	}

	function handleModelSelection(event: CustomEvent) {
		console.log('🔄 MessageInput handleModelSelection - event.detail:', event.detail);

		if (!event.detail) {
			console.error('❌ No event detail in MessageInput handleModelSelection');
			return;
		}

		console.log('✅ MessageInput dispatching model selection');
		dispatch('modelSelection', event.detail);
	}

	function handleSysPromptSelect(event: CustomEvent) {
		console.log('Sys prompt selected:', event.detail);
		dispatch('sysPromptSelect', { prompt: event.detail });
	}

	function handlePromptSelect(event: CustomEvent) {
		console.log('Prompt selected:', event.detail);
		dispatch('promptSelect', { prompt: event.detail });
	}

	function handleCollaboratorSelect(event: CustomEvent) {
		console.log('Collaborator selected:', event.detail);
		dispatch('collaboratorSelect', { collaborator: event.detail });
	}

	function handleLoadThread(event: CustomEvent) {
		console.log('Loading thread:', event.detail);
		dispatch('loadThread', { threadId: event.detail.threadId });
	}

	function clearUserInput() {
		userInput = '';
		console.log('Input cleared');
		dispatch('inputCleared');
	}

	function openTextModal() {
		showTextModal = true;
		console.log('Text modal opened');
		dispatch('textModalOpen');
	}
	// 	let cachedShowButtons = false;
	// 	let cachedProjectId = '';
	// let currentThreadData = null;
	// let expandedSectionsData = {};
	// let currentUserData = null;

	// $: projectId = $threadsStore.currentThread?.project_id || '';

	// $: placeholderText = (currentManualPlaceholder as string) || '';

	export { textareaElement };

	// let lastUserInputLength = 0;
	// let memoizedTextTooLong = false;

	// $: {
	//     if (userInput.length !== lastUserInputLength) {
	//         memoizedTextTooLong = userInput.length > MAX_VISIBLE_CHARS;
	//         lastUserInputLength = userInput.length;
	//     }
	//     textTooLong = memoizedTextTooLong;
	// }

	// let cachedExpandedSections = {};
	// $: {
	//     // Only update if expandedSections actually changed
	//     const currentSections = $expandedSections;
	//     if (JSON.stringify(currentSections) !== JSON.stringify(cachedExpandedSections)) {
	//         cachedExpandedSections = { ...currentSections };
	//     }
	// }

	// Debug reactive statement
	// $: console.log('MessageInput props:', { isPlaceholder, currentThreadId, isAiActive });

	let textTooLong = false;
	let showButtons = false;
	let uiUpdateTimer: number | undefined;

	$: {
		if (uiUpdateTimer) clearTimeout(uiUpdateTimer);
		uiUpdateTimer = setTimeout(() => {
			textTooLong = userInput.length > MAX_VISIBLE_CHARS;
			showButtons = isFocused || isButtonAreaHovered;
		}, 50) as unknown as number;
	}
	function clearAllTimers() {
		if (focusDebounceTimer) clearTimeout(focusDebounceTimer);
		if (inputTimeout) clearTimeout(inputTimeout);
		if (resizeTimeout) clearTimeout(resizeTimeout);
		if (clickOutsideTimeout) clearTimeout(clickOutsideTimeout);
		if (blurTimeout) clearTimeout(blurTimeout);
		// if (focusLockTimer) clearTimeout(focusLockTimer);
	}

	onMount(() => {
		placeholderText = (currentManualPlaceholder as string) || '';
		document.addEventListener('click', handleClickOutside, { passive: true });

		return () => {
			document.removeEventListener('click', handleClickOutside);
			clearAllTimers();
		};
	});
</script>

<div
	class="input-container"
	class:input-container-start={isPlaceholder}
	class:drawer-visible={$showThreadList}
>
	<!-- AI Active Mode or Placeholder Input -->
	{#if (isAiActive && !isPlaceholder) || isPlaceholder}
		<div class="ai-selector">
			<!-- Collaborators Section -->
			{#if $expandedSections.collaborators && currentThreadId && !isPlaceholder}
				<div class="section-content" in:slide={{ duration: 200 }} out:slide={{ duration: 200 }}>
					<ThreadCollaborators
						threadId={currentThreadId}
						projectId={$threadsStore.currentThread?.project_id || ''}
						on:select={handleCollaboratorSelect}
					/>
				</div>
			{/if}

			<!-- System Prompts Section -->
			{#if $expandedSections.sysprompts}
				<div class="section-content">
					<SysPromptSelector on:select={handleSysPromptSelect} />
				</div>
			{/if}

			<!-- Prompts Section -->
			{#if $expandedSections.prompts}
				<div class="section-content">
					<PromptCatalog on:select={handlePromptSelect} />
				</div>
			{/if}

			<!-- Models Section -->
			{#if $expandedSections.models}
				<div class="section-content">
					<ModelSelector provider={aiModel?.provider} on:select={handleModelSelection} />
				</div>
			{/if}

			<!-- Bookmarks Section -->
			{#if $expandedSections.bookmarks}
				<div class="section-content-bookmark">
					<MsgBookmarks on:loadThread={handleLoadThread} />
				</div>
			{/if}
		</div>

		<!-- Input Area -->
		<div class="combo-input">
			<!-- {#if userInput.length > MAX_VISIBLE_CHARS && !$isTextareaFocused}
				<div class="text-preview-container">
					<button class="text-preview-btn" on:click={openTextModal}>
						View/Edit Text ({userInput.length} chars)
					</button>
					<button class="text-trash-btn" on:click={clearUserInput}>
						<Icon name="TrashIcon" size={16} />
					</button>
				</div>
			{:else} -->
			<!-- Textarea -->
			<textarea
				bind:this={textareaElement}
				bind:value={userInput}
				on:input={handleInput}
				on:keydown={handleKeydown}
				on:focus={onTextareaFocus}
				on:blur={onTextareaBlur}
				placeholder={placeholderText}
				disabled={isLoading}
				rows="1"
			/>
			<!-- {/if} -->

			<!-- Button Row -->
			<div
				class="btn-row"
				role="region"
				aria-label="Message input controls"
				transition:slide
				on:mouseenter={() => {
					isButtonAreaHovered = true;
					if (blurTimeout) {
						clearTimeout(blurTimeout);
						blurTimeout = undefined;
					}
				}}
				on:mouseleave={() => {
					isButtonAreaHovered = false;
				}}
			>
				{#if showButtons}
					<div class="submission">
						<!-- AI Toggle Button (only for existing threads) -->
						{#if currentThreadId && !isPlaceholder}
							<button
								class="btn model"
								type="button"
								on:mouseenter={() => (createHovered = true)}
								on:mouseleave={() => (createHovered = false)}
								on:click={toggleAiActive}
							>
								{#if isAiActive}
									<Icon name="PlugZap" size={20} />
									{#if createHovered}
										<span class="tooltip" in:fade>
											{$t('tooltip.pauseAi')}
										</span>
									{/if}
								{:else}
									<Icon name="ZapOff" size={20} />
									{#if createHovered}
										<span class="tooltip" in:fade>
											{$t('tooltip.playAi')}
										</span>
									{/if}
								{/if}
							</button>

							<!-- Collaborators Button -->
							<button
								class="btn model"
								type="button"
								on:click={() => toggleSection('collaborators')}
							>
								<span class="icon">
									{#if $expandedSections.collaborators}
										<Icon name="Users" size={30} />
									{:else}
										<Icon name="Users" size={20} />
									{/if}
								</span>
							</button>
						{/if}

						<!-- Bookmarks Button -->
						<button class="btn model" type="button" on:click={() => toggleSection('bookmarks')}>
							<span class="icon">
								{#if $expandedSections.bookmarks}
									<Icon name="BookmarkCheckIcon" size={30} />
								{:else}
									<Icon name="Bookmark" size={20} />
								{/if}
							</span>
							<p class="selector-lable">{$t('chat.bookmarks')}</p>
						</button>

						<!-- Prompts Button -->
						<button class="btn model" type="button" on:click={() => toggleSection('prompts')}>
							<span class="icon">
								{#if $expandedSections.prompts}
									<Icon name="Braces" size={30} />
								{:else}
									<Icon name="Braces" size={20} />
								{/if}
							</span>
							{#if $expandedSections.prompts}
								<p class="selector-lable">{$t('chat.prompts')}</p>
							{:else}
								<p class="selector-lable">{$t('chat.prompts')}</p>
							{/if}
						</button>

						<!-- System Prompts Button -->
						<button class="btn model" type="button" on:click={() => toggleSection('sysprompts')}>
							<span class="icon">
								{#if $expandedSections.sysprompts}
									<Icon name="Command" size={24} />
								{:else}
									<Icon name="Command" size={20} />
								{/if}
							</span>
							{#if selectedPromptLabel}
								<p class="selector-lable">{selectedPromptLabel}</p>
							{:else}
								<p class="selector-lable">{$t('chat.sysPrompts')}</p>
							{/if}
							<!-- <div class="label-container">
								{#if $currentUser?.sysprompt_preference}
									{#if $currentUser.sysprompt_preference === 'NORMAL'}
										<span class="prompt-label">Normal</span>
									{:else if $currentUser.sysprompt_preference === 'CONCISE'}
										<span class="prompt-label">Concise</span>
									{:else if $currentUser.sysprompt_preference === 'CRITICAL'}
										<span class="prompt-label">Critical</span>
									{:else if $currentUser.sysprompt_preference === 'INTERVIEW'}
										<span class="prompt-label">Interview</span>
									{:else}
										<span class="prompt-label">{$currentUser.sysprompt_preference}</span>
									{/if}
								{/if}
							</div> -->
						</button>

						<!-- Model Selection Button -->
						<button
							class="btn model"
							type="button"
							disabled={isLoading}
							on:click={() => toggleSection('models')}
						>
							<span class="icon">
								<Icon name="Brain" />
							</span>
							{#if selectedModelLabel}
								<p class="selector-lable">{selectedModelLabel}</p>
							{:else}
								<p class="selector-lable">{$t('agents.models')}</p>
							{/if}
						</button>

						<!-- Send Button -->
						<button
							class="btn send-btn"
							type="button"
							on:click={handleSendMessage}
							disabled={isLoading}
						>
							<Icon name="Send" />
						</button>
					</div>
				{/if}
			</div>
		</div>
	{/if}

	<!-- Human-only Mode Input (when AI is disabled) -->
	{#if !isAiActive && !isPlaceholder}
		<div class="combo-input-human" in:fly={{ x: 200, duration: 300 }} out:fade={{ duration: 200 }}>
			<textarea
				bind:this={textareaElement}
				bind:value={userInput}
				on:input={handleInput}
				on:keydown={handleKeydown}
				on:focus={onTextareaFocus}
				on:blur={onTextareaBlur}
				placeholder={placeholderText}
				disabled={isLoading}
				rows="1"
			/>

			<div
				class="btn-row"
				role="region"
				aria-label="Message input controls"
				on:mouseenter={() => {
					isButtonAreaHovered = true;
					if (blurTimeout) {
						clearTimeout(blurTimeout);
						blurTimeout = undefined;
					}
				}}
				on:mouseleave={() => {
					isButtonAreaHovered = false;
				}}
			>
				<div class="submission" class:visible={isTextareaFocused}>
					{#if isTextareaFocused}
						{#if currentThreadId}
							<!-- AI Toggle Button -->
							<button
								class="toggle-btn response"
								type="button"
								on:mouseenter={() => (createHovered = true)}
								on:mouseleave={() => (createHovered = false)}
								on:click={toggleAiActive}
							>
								{#if isAiActive}
									<Icon name="PlugZap" size={20} />
									{#if createHovered}
										<span class="tooltip" in:fade>
											{$t('tooltip.pauseAi')}
										</span>
									{/if}
								{:else}
									<Icon name="ZapOff" size={20} />
									{#if createHovered}
										<span class="tooltip" in:fade>
											{$t('tooltip.playAi')}
										</span>
									{/if}
								{/if}
							</button>
						{/if}

						<!-- Attachment Button -->
						<button class="btn" type="button">
							<Icon name="Paperclip" />
						</button>

						<!-- Send Button -->
						<button
							class="btn send-btn"
							type="button"
							class:visible={isTextareaFocused}
							on:click={handleSendMessage}
							disabled={isLoading}
						>
							<Icon name="Send" />
						</button>
					{/if}
				</div>
			</div>
		</div>
	{/if}
</div>

<style lang="scss">
	$breakpoint-sm: 576px;
	$breakpoint-md: 1000px;
	$breakpoint-lg: 992px;
	$breakpoint-xl: 1200px;
	// @use 'src/lib/styles/themes.scss' as *;
	* {
		font-family: var(--font-family);
	}

	:root {
		--h3-min-size: 0.875rem;
		--h3-max-size: 1.125rem;
		--breakpoint-sm: #{$breakpoint-sm};
		--breakpoint-md: #{$breakpoint-md};
		--breakpoint-lg: #{$breakpoint-lg};
		--breakpoint-xl: #{$breakpoint-xl};
	}

	span {
		display: flex;
		justify-content: left;
		align-items: center;
		color: var(--text-color);

		&.btn {
			display: flex;
			width: auto;
			border-radius: 50%;
			padding: 0.5rem;
			width: 2rem;
			height: 2rem;
			transition: all 0.2s ease;
			border: none;
			z-index: 9999;
			&:hover {
				cursor: pointer;
				transform: scale(1.3);
				background: var(--bg-gradient-left);
			}
		}

		&.start {
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			height: auto !important;
			width: auto;
			margin-bottom: 0 !important;
			max-width: 800px;
			gap: 0.5rem;
			margin: 0;

			position: relative;
			& p {
				font-size: 1.5rem;
			}
			&:hover {
				animation: shake 2.8s ease;
			}
			& h3 {
				font-size: 2rem;
				display: flex;
				width: auto;
				max-width: 800px;
				justify-content: center !important;
				align-items: center !important;
				padding: 0 !important;
			}

			& img.logo {
				width: 3rem;
				height: 3rem;

				margin-top: auto;
				display: flex;
				justify-content: center;
				align-items: center;
			}
		}

		&.icon {
			transition: color 0.2s ease-in-out;
			gap: 0.5rem;
			height: 36px;

			& &.active {
				color: var(--bg-color) !important;
			}
		}
		&.counter {
			color: var(--placeholder-color);
			font-size: 16px;
			max-width: 100px;
			margin: 0 !important;
			display: flex;
			flex-direction: row;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}

		&.role {
			display: flex;
			justify-content: center;
			align-items: center;
		}
		&.model {
			display: flex;
			box-shadow: rgba(128, 128, 128, 0.8);
			justify-content: center;
			align-items: center;
			gap: 0.5rem;
			border-radius: 1rem;
		}
	}
	.btn {
		display: flex;
		justify-content: center;
		align-items: center;
		// box-shadow: 2px -4px 20px 1px rgba(255, 255, 255, 0.1);
		transition: all 0.2s ease;
		border: none;
		width: auto;

		padding: 0 0.5rem !important;
		&:hover {
			// transform: translateX(-1rem);
			span.icon {
				display: none;
			}
			p.selector-lable {
				display: inline-flex;
				color: var(--tertiary-color);
				width: 100%;
			}
			& .prompt-label {
				display: flex;
			}
		}
		&.send-btn {
			border-radius: 1rem;
			width: 3rem !important;
			height: 3rem !important;
			background: var(--bg-color) !important;
			&:hover {
				background: var(--tertiary-color);
			}
		}
		&.model {
			border-radius: 1rem;
			width: 3rem !important;
			padding: 0;
			gap: 0.5rem;
			background: var(--bg-color) !important;
			display: flex;
			justify-content: center;
			p.selector-lable {
				display: none;
			}
			& .prompt-label {
				display: none;
			}
			&:hover {
				width: auto !important;
				justify-content: center;

				// transform: translateX(1rem);
				p.selector-lable {
					display: inline-flex;
					text-wrap: nowrap;
					width: 100%;
					margin: 0 !important;
				}
			}
		}

		&.send-btn {
			background-color: var(--tertiary-color);
			width: 2rem;
			height: 2rem;
			border-radius: 50%;
			&:hover {
				cursor: pointer;
				transform: scale(1.3);
				background: var(--bg-gradient-left);
			}
		}
	}

	.casual-input {
		background: var(--bg-color);
		width: 100%;
		display: flex;
		position: relative;
		bottom: auto;
		top: 0;
		height: 200px;
	}
	.drawer-visible .input-container {
		bottom: 3rem;
		position: absolute;
	}
	/* =============================================================================
   INPUT CONTAINER STYLES
   ============================================================================= */

	.input-container {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		max-width: 1200px;
		width: 100%;
		height: auto;
		bottom: 3rem;
		border-radius: 2rem;
		transition:
			transform 0.2s ease,
			opacity 0.2s ease;
		z-index: 7700;
		pointer-events: auto;

		&::placeholder {
			color: var(--placeholder-color);
		}

		:global(svg) {
			color: var(--primary-color);
			stroke: var(--primary-color);
			fill: var(--tertiary-color);
		}

		& textarea {
			font-size: 1.5rem;
			border: none;
			border-radius: 1rem;
			color: var(--text-color);
			display: flex;
		}
	}

	.drawer-visible .input-container {
		bottom: 3rem;
		position: absolute;
	}

	/* =============================================================================
   INPUT CONTAINER START
   ============================================================================= */

	.input-container-start {
		display: flex;
		flex-direction: column;
		justify-content: flex-end;
		align-items: center;
		position: absolute;
		width: calc(100% - 1rem);
		height: auto;
		bottom: 0.5rem;
		z-index: 1;
		transition: all 0.1s ease;

		& .combo-input {
			background: var(--primary-color);
			display: flex;
			justify-content: center;
			align-items: stretch;
			border-radius: 2rem;
			width: 100%;
			height: auto;
		}

		&::placeholder {
			color: var(--placeholder-color);
		}

		:global(svg) {
			color: var(--primary-color);
			stroke: var(--primary-color);
			fill: var(--tertiary-color);
		}

		& textarea {
			border: none;
			background: transparent;
			color: var(--text-color);
			display: flex;
			font-size: 1.5rem;
			width: calc(100% - 2rem);
			border-radius: 2rem;
			transition: height 0.1s ease;
			max-height: 100px;
			&:focus {
				overflow-y: auto;
				display: flex;
				max-height: 400px;
			}
		}
	}

	/* =============================================================================
   COMBO INPUT STYLES
   ============================================================================= */

	.combo-input {
		border-radius: var(--radius-m);
		height: auto;
		width: 100%;
		display: flex;
		position: relative;
		align-items: stretch;
		flex-direction: column;
		max-height: 400px;
		overflow: hidden;

		& textarea {
			padding: 1rem;
			height: auto;
			width: 100%;
			margin: 1rem 1rem 0;
			font-size: 1rem;
			flex: 1;

			&:focus {
				height: auto;
				margin-top: 1.5rem;
				margin-bottom: 0;
				overflow-y: scroll;
				flex: 1;
			}
		}
	}

	.combo-input-human {
		border-radius: var(--radius-m);
		height: auto;
		width: 100%;
		max-width: 1200px;
		display: flex;
		position: relative;
		background: transparent;
		flex-direction: column;

		& .btn-row {
			display: flex;
			flex-direction: row;
			justify-content: flex-end;
			margin-top: 0.5rem;
			width: calc(100% - 8rem);
		}

		& .submission {
			flex-direction: row;
		}

		& textarea {
			height: 100px;
			border-radius: 4rem;
			margin: 1rem 1rem 0;
			margin-top: 0.5rem;
			padding-left: 2rem;
			font-style: normal;
			z-index: 1000;

			&:focus {
				min-height: 400px;
				box-shadow: 0px 1px 210px 1px rgba(255, 255, 255, 0.2);
				margin: 2.5rem 2.5rem 0;
				margin-top: 0.5rem;
			}
		}
	}

	/* =============================================================================
   TEXTAREA STYLES
   ============================================================================= */

	textarea {
		display: flex;
		flex-direction: column;
		width: 100%;
		min-height: 80px;
		resize: none;
		letter-spacing: 1.4px;
		background: transparent;
		border: 1px solid rgba(8, 16, 16, 0.5);
		color: var(--text-color);
		line-height: 1.4;
		text-align: left;
		overflow: scroll;
		scrollbar-width: none;
		scrollbar-color: #21201d transparent;
		vertical-align: middle;
		transition: border-color 0.2s ease;
		// transition: all 0.3s cubic-bezier(0.075, 0.82, 0.165, 1);
		// margin: 1rem 0 0 1rem;
		// padding: 0.5rem;

		&:focus {
			outline: none;
			border-color: var(--tertiary-color);
		}

		&::placeholder {
			color: var(--placeholder-color);
			width: calc(100% - 2rem);
			display: flex;
			text-align: center;
			user-select: none;
			font-size: 1.1rem;
			letter-spacing: 0.2rem;
		}

		&.quote-placeholder::placeholder {
			font-style: italic;
			opacity: 0.8;
			padding: 1rem;
			font-size: 0.8rem;
			display: flex;
			flex: 1;
			justify-content: center;
			align-items: flex-start;
			height: auto;
			user-select: none;
		}
	}

	/* =============================================================================
   SECTION AND BUTTON STYLES
   ============================================================================= */

	.section-content {
		width: calc(100vw - 2rem);
		max-width: 1200px;
		height: auto;
		display: flex;
		position: relative;
		bottom: 0;
		right: 0;
		background: var(--bg-gradient-r);
		margin-bottom: 1rem;
		border-radius: 2rem;
		justify-content: flex-end;
		box-shadow: var(--tertiary-color) 0 -10px 24px 2px;
	}

	.btn-row {
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		height: 100%;
		margin: 0 1rem 0.5rem 0;
		width: auto;
		z-index: 8000;
	}

	.submission {
		display: flex;
		flex-direction: row;
		margin: 0.5rem;
		gap: 0.5rem;
		padding: 0;
		width: 100%;
		height: 100%;
		justify-content: flex-end;
		align-self: flex-end;
		transition: all 0.3s ease;
		padding: 0.5rem;

		&.visible {
			z-index: 7000;
		}
	}
	@media (max-width: 1000px) {
		.chat-placeholder {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: flex-start;
			border-radius: var(--radius-m);
			// background: var(--primary-color);
			transition: all 0.3s ease;
			margin-left: 0;
			margin-right: 0;

			margin-top: 0;
			height: calc(100vh - 2rem);
			user-select: none;
			scrollbar-width: thin;
			scrollbar-color: var(--secondary-color) transparent;
			scroll-behavior: smooth;
			width: 100%;
		}

		span.header-btns {
			display: flex;
			flex-direction: row !important;
			right: 0;
			bottom: 0;
			margin-right: 0.5rem;
			margin-top: 0;
			width: auto !important;
		}

		.toggle-btn {
			width: auto;
			padding: 0.5rem !important;
			height: auto;
		}

		// .logo-container {
		//   display: flex;
		// }
		.chat-container {
			margin-left: 0;
			margin-right: 0;
			right: 0;
			width: 100%;
		}
		.chat-content {
			margin-right: 0;
		}

		// .chat-header {
		//   margin-top: 1rem;
		//   padding: 1rem;
		//   width: 90%;
		// }

		.drawer-visible {
			&.chat-container {
				margin-left: 0;
				left: 0;
			}
		}

		button {
			display: flex;
			user-select: none;
			.toggle-btn {
				&.header {
					background-color: red !important;
					width: 500px;
				}
			}
			&.play {
				background: transparent;
				display: flex;
				justify-content: center;
				align-items: center;
				width: 3rem;
				height: 3rem;
			}
			&.btn-back {
				background-color: var(--placeholder-color);
				position: relative;
				display: flex;
				overflow-x: none;
				// height: 50%;
				// top: 3rem;
				justify-content: center;
				align-items: center;
				border: none;
				color: var(--text-color);
				cursor: pointer;
				border-radius: var(--radius-l);
				transition: all 0.3s ease;
				// &:hover {
				//   background-color: var(--tertiary-color);
				//   transform: translateX(2px);
				// }
				// &:active {
				// }
			}

			&.btn-ai {
				border-radius: var(--radius-m);
				width: auto;
				height: auto;
				border: none;
				display: flex;
				justify-content: center;
				align-items: center;
				transition: all 0.3s ease;
				justify-content: center !important;
				background-color: transparent;
				z-index: 2000;
				&:hover {
					background: var(--secondary-color);
					// box-shadow: -0 2px 20px 1px rgba(255, 255, 255, 0.1);
					transform: translateY(-10px);
				}
			}
			&.drawer-header {
				justify-content: space-between;
				width: 100%;
				height: 100%;
				gap: 0.5rem;
				&:hover {
					background-color: var(--secondary-color);
				}
			}
			&.add {
				background-color: transparent;
				font-size: var(--font-size-s);
				font-weight: bold;
				cursor: pointer;
				transition: all ease 0.3s;
				display: flex;
				justify-content: center;
				align-items: center;
				position: relative;
				user-select: none;
				width: fit-content !important;

				// gap: var(--spacing-sm);

				& span.icon {
					color: var(--placeholder-color);
					gap: 0.5rem;

					&:hover {
						color: var(--tertiary-color);
					}

					&.active {
						color: var(--tertiary-color);
					}
				}

				&:hover {
					color: var(--tertiary-color);
				}
			}
		}

		.toolbar-button {
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 0;
			height: 3rem;
			width: 3rem;
			padding: 0;
			border-radius: 4rem;

			border: 1px solid var(--border-color, #e2e8f0);
			cursor: pointer;
			&:hover {
				background-color: var(--secondary-color);
			}

			&.active {
				background-color: var(--tertiary-color);
			}
		}

		.card {
			margin-left: 0;
			width: 100%;
		}

		.submission {
			display: flex;
			flex-direction: row;
			gap: 1rem;
			width: auto;
			height: auto;
			justify-content: flex-end;
			align-self: flex-end;
			// padding: 0.5rem;
			transition: all 0.3s ease;
		}

		.btn-col-left {
			display: flex;
			flex-direction: column;
			gap: 10px;
			position: fixed;
			left: 0;
			top: 0;
			height: 90%;
			width: auto;
			align-items: left;
			justify-content: flex-end;
			z-index: 10;
			border-radius: 1rem;
			padding: 0.5rem;
			transition: all 0.3s ease-in;
		}

		.selector-lable {
			display: none;
		}
	}

	@media (max-width: 450px) {
		.input-container-start {
			width: calc(100% - 2rem);
			margin-bottom: 0.5rem;
		}
		.btn-row {
			gap: 0.5rem;
			width: 100%;
			height: 2.5rem;
		}
		.submission {
			& .model,
			.send-btn {
				width: 2.5rem !important;
				height: 2.5rem !important;
			}
		}
	}
</style>
